import openpyxl
import os
import sys

# Define source and destination files
source_file = "source.xlsx"
destination_file = "destination.xlsx"

def copy_rows_with_quality_3(source_file, destination_file):
    # Check if source file exists
    if not os.path.exists(source_file):
        print(f"Error: Cannot open source file '{source_file}'. File does not exist.")
        sys.exit(1)

    # Try to load the source workbook
    try:
        source_wb = openpyxl.load_workbook(source_file)
    except Exception as e:
        print(f"Error while opening the source Excel file: {e}")
        sys.exit(1)

    source_sheet = source_wb.active

    # Try to open existing destination file
    if not os.path.exists(destination_file):
        print(f"Error: Destination file '{destination_file}' does not exist.")
        sys.exit(1)

    try:
        dest_wb = openpyxl.load_workbook(destination_file)
    except Exception as e:
        print(f"Error while opening the destination Excel file: {e}")
        sys.exit(1)

    dest_sheet = dest_wb.active

    # Find the index of the 'quality' column
    header = [cell.value for cell in next(source_sheet.iter_rows(min_row=1, max_row=1))]
    if 'quality' not in header:
        print("Error: Column 'quality' not found in the source file.")
        sys.exit(1)

    quality_index = header.index('quality')  # zero-based index

    # Find first empty row in destination sheet
    dest_start_row = dest_sheet.max_row + 1

    rows_copied = 0

    # Loop through source rows (excluding header)
    for row in source_sheet.iter_rows(min_row=2, values_only=True):
        if row[quality_index] == 3:
            dest_sheet.append(row)
            rows_copied += 1

    if rows_copied > 0:
        dest_wb.save(destination_file)
        print(f"{rows_copied} row(s) with quality=3 appended to '{destination_file}'.")
    else:
        print("No rows with quality=3 found. Nothing was copied.")

# Run the function
copy_rows_with_quality_3(source_file, destination_file)
